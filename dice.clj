;; How should we calculate the probabilities of dice rolls?

;; Consider 2D6

;; A D6 can be represented as
(def D6 { 1 1/6 2 1/6 3 1/6 4 1/6 5 1/6 6 1/6 })

(defn combine-dists [d1 d2]
  (reduce #(merge-with + %1 %2) {}
          (for [[v1 p1] d1
                [v2 p2] d2]
            {(+ v1 v2) (* p1 p2)})))

(combine-dists D6 D6) ; {2 1/36, 3 1/18, 4 1/12, 5 1/9, 6 5/36, 7 1/6, 8 5/36, 9 1/9, 10 1/12, 11 1/18, 12 1/36}
(combine-dists D6 (combine-dists D6 D6)) ; {2 1/36, 3 1/18, 4 1/12, 5 1/9, 6 5/36, 7 1/6, 8 5/36, 9 1/9, 10 1/12, 11 1/18, 12 1/36}

(reduce combine-dists (repeat 30 D6))

(defn fast-combine-dists [& dists]
  (let [c (count dists)
        a (int (/ c 2))]
    (cond (= c 0) {}
          (= c 1) (first dists)
          (= c 2) (apply combine-dists dists)
          :else
          (combine-dists
           (apply fast-combine-dists (take a dists))
           (apply fast-combine-dists (drop a dists))))))

(fast-combine-dists)
(fast-combine-dists D6)
(fast-combine-dists D6 D6 D6)

(def doubleD6 (into {} (map (fn [[a b]] [a (double b)]) D6)))

(reverse (sort-by second (apply fast-combine-dists (repeat 10 doubleD6)))) ; ([35 0.0726928059746992] [34 0.07153271938347831] [36 0.0715327193834783] [37 0.06815810545055821] [33 0.06815810545055821] [32 0.0628704385076379] [38 0.06287043850763789] [31 0.05612410482184303] [39 0.05612410482184303] [30 0.04846436791372434] [40 0.04846436791372434] [29 0.040457329400159295] [41 0.040457329400159295] [28 0.03262369361674212] [42 0.03262369361674212] [27 0.0253867550678251] [43 0.025386755067825093] [26 0.01904155473632074] [44 0.019041554736320736] [25 0.013746594459686066] [45 0.013746594459686064] [24 0.009535330959245742] [46 0.00953533095924574] [23 0.006341892697166778] [47 0.006341892697166778] [22 0.004034073528975947] [48 0.004034073528975946] [21 0.002446657119510922] [49 0.002446657119510922] [20 0.0014095152966180672] [50 0.001409515296618067] [51 7.677019297532581E-4] [19 7.677019297532581E-4] [52 3.9294695930498514E-4] [18 3.9294695930498514E-4] [53 1.8754286694101565E-4] [17 1.8754286694101565E-4] [54 8.260816758116167E-5] [16 8.260816758116167E-5] [55 3.3109419719216343E-5] [15 3.3109419719216343E-5] [14 1.182479275686298E-5] [56 1.1824792756862979E-5] [57 3.6383977713424552E-6] [13 3.638397771342455E-6] [58 9.095994428356137E-7] [12 9.095994428356137E-7] [59 1.6538171687920248E-7] [11 1.6538171687920248E-7] [60 1.6538171687920247E-8] [10 1.6538171687920247E-8])